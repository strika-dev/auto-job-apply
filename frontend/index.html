<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #f5f5f0;
            --fg: #1a1a1a;
            --accent: #e63946;
            --muted: #6b6b6b;
            --border: #1a1a1a;
            --card: #ffffff;
            --success: #2d6a4f;
            --warning: #bc6c25;
        }
        
        body {
            font-family: 'Space Grotesk', system-ui, sans-serif;
            background: var(--bg);
            color: var(--fg);
            line-height: 1.5;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 220px;
            background: var(--fg);
            color: var(--bg);
            padding: 24px 0;
            display: flex;
            flex-direction: column;
        }
        
        .logo {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            font-weight: 600;
            padding: 0 24px 24px;
            border-bottom: 1px solid #333;
            letter-spacing: -0.5px;
        }
        
        .nav { padding: 24px 0; flex: 1; }
        
        .nav-item {
            display: block;
            width: 100%;
            padding: 12px 24px;
            background: none;
            border: none;
            color: #888;
            font-family: inherit;
            font-size: 14px;
            text-align: left;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .nav-item:hover { color: var(--bg); padding-left: 28px; }
        .nav-item.active { color: var(--bg); background: #333; border-left: 3px solid var(--accent); }
        
        .nav-item span { margin-right: 12px; }
        
        .sidebar-footer {
            padding: 24px;
            border-top: 1px solid #333;
        }
        
        .btn-new {
            width: 100%;
            padding: 12px;
            background: var(--accent);
            color: white;
            border: none;
            font-family: inherit;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.1s;
        }
        
        .btn-new:hover { transform: translateY(-1px); }
        .btn-new:active { transform: translateY(0); }
        
        /* Main */
        .main {
            margin-left: 220px;
            padding: 48px;
            min-height: 100vh;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -1px;
            margin-bottom: 8px;
        }
        
        .page-desc {
            color: var(--muted);
            font-size: 14px;
            margin-bottom: 32px;
        }
        
        /* Cards */
        .card {
            background: var(--card);
            border: 2px solid var(--border);
            padding: 24px;
            margin-bottom: 16px;
        }
        
        .card-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--muted);
            margin-bottom: 16px;
        }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--card);
            border: 2px solid var(--border);
            padding: 20px;
        }
        
        .stat-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--muted);
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: -2px;
            margin-top: 4px;
        }
        
        .stat-value.accent { color: var(--accent); }
        .stat-value.success { color: var(--success); }
        
        /* Table */
        .table-wrap {
            background: var(--card);
            border: 2px solid var(--border);
            overflow: hidden;
        }
        
        table { width: 100%; border-collapse: collapse; }
        
        th {
            text-align: left;
            padding: 16px 20px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--muted);
            border-bottom: 2px solid var(--border);
            background: var(--bg);
        }
        
        td {
            padding: 16px 20px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        
        tr:hover td { background: #fafafa; }
        
        .company-name { font-weight: 600; }
        .company-loc { font-size: 12px; color: var(--muted); }
        
        /* Status */
        .status {
            display: inline-block;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1.5px solid;
        }
        
        .status-pending { border-color: #888; color: #888; }
        .status-applied { border-color: #0077b6; color: #0077b6; }
        .status-interview { border-color: var(--success); color: var(--success); }
        .status-offer { border-color: var(--warning); color: var(--warning); background: #fffbeb; }
        .status-rejected { border-color: var(--accent); color: var(--accent); }
        
        /* Forms */
        .form-group { margin-bottom: 20px; }
        
        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            font-family: inherit;
            font-size: 14px;
            background: var(--card);
            transition: border-color 0.15s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        textarea.form-input {
            resize: vertical;
            min-height: 120px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
        }
        
        select.form-input {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%231a1a1a' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            font-family: inherit;
            font-size: 13px;
            font-weight: 600;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.15s;
            background: var(--card);
        }
        
        .btn:hover { background: var(--fg); color: var(--bg); }
        
        .btn-primary {
            background: var(--fg);
            color: var(--bg);
            border-color: var(--fg);
        }
        
        .btn-primary:hover { background: #333; }
        
        .btn-danger { border-color: var(--accent); color: var(--accent); }
        .btn-danger:hover { background: var(--accent); color: white; }
        
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        
        .btn-icon {
            padding: 8px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--muted);
            transition: color 0.15s;
        }
        
        .btn-icon:hover { color: var(--fg); }
        .btn-icon.danger:hover { color: var(--accent); }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 24px;
        }
        
        .modal {
            background: var(--card);
            border: 2px solid var(--border);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px 24px;
            border-bottom: 2px solid var(--border);
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-body { padding: 24px; }
        
        .modal-footer {
            padding: 16px 24px;
            border-top: 2px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: var(--bg);
        }
        
        /* Grid layouts */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
        
        /* Utils */
        .flex { display: flex; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; }
        .gap-8 { gap: 8px; }
        .gap-16 { gap: 16px; }
        .mt-16 { margin-top: 16px; }
        .mt-24 { margin-top: 24px; }
        .mb-24 { margin-bottom: 24px; }
        .text-muted { color: var(--muted); }
        .text-sm { font-size: 13px; }
        .text-mono { font-family: 'IBM Plex Mono', monospace; }
        
        /* Filter bar */
        .filter-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .filter-bar .form-input { width: auto; }
        .search-input { flex: 1; max-width: 300px; }
        
        /* Alert */
        .alert {
            padding: 16px 20px;
            border: 2px solid;
            margin-bottom: 24px;
            font-size: 14px;
        }
        
        .alert-warning {
            border-color: var(--warning);
            background: #fffbeb;
        }
        
        /* Settings sections */
        .settings-section {
            background: var(--card);
            border: 2px solid var(--border);
            margin-bottom: 24px;
        }
        
        .settings-header {
            padding: 16px 24px;
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            background: var(--bg);
        }
        
        .settings-body { padding: 24px; }
        
        /* Test button result */
        .test-result {
            font-size: 13px;
            padding: 8px 12px;
            background: var(--bg);
        }
        
        .test-result.success { color: var(--success); }
        .test-result.error { color: var(--accent); }
        
        /* Checkbox */
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .checkbox-label input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: var(--muted);
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted);
        }
        
        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--fg);
        }
        
        /* AI Result */
        .ai-result {
            background: var(--bg);
            border: 2px solid var(--border);
            padding: 20px;
            margin-top: 16px;
        }
        
        .ai-result pre {
            white-space: pre-wrap;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .match-score {
            font-size: 48px;
            font-weight: 700;
            letter-spacing: -3px;
        }
        
        .keyword-tag {
            display: inline-block;
            padding: 4px 10px;
            background: var(--bg);
            border: 1px solid var(--border);
            font-size: 12px;
            margin: 2px;
        }
        
        /* Job search results */
        .job-item {
            padding: 16px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .job-item:hover { background: #fafafa; }
        
        .job-title { font-weight: 600; margin-bottom: 4px; }
        .job-meta { font-size: 13px; color: var(--muted); }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const API = 'http://localhost:5000/api';
        
        // API
        const api = {
            get: async (url) => (await fetch(API + url)).json(),
            post: async (url, data) => (await fetch(API + url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })).json(),
            put: async (url, data) => (await fetch(API + url, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })).json(),
            del: async (url) => (await fetch(API + url, { method: 'DELETE' })).json()
        };
        
        // Status component
        const Status = ({ status }) => {
            const map = {
                pending: ['pending', 'Pending'],
                applied: ['applied', 'Applied'],
                interview_scheduled: ['interview', 'Interview'],
                interviewed: ['interview', 'Interviewed'],
                offer_received: ['offer', 'Offer'],
                rejected: ['rejected', 'Rejected'],
                withdrawn: ['pending', 'Withdrawn']
            };
            const [cls, label] = map[status] || ['pending', status];
            return <span className={`status status-${cls}`}>{label}</span>;
        };
        
        // Dashboard
        const Dashboard = ({ stats, apps }) => (
            <div>
                <h1 className="page-title">Dashboard</h1>
                <p className="page-desc">Your job search at a glance</p>
                
                <div className="stats-grid">
                    <div className="stat-card">
                        <div className="stat-label">Total</div>
                        <div className="stat-value">{stats.total_applications || 0}</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-label">Response Rate</div>
                        <div className="stat-value accent">{stats.response_rate || 0}%</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-label">Interviews</div>
                        <div className="stat-value success">{stats.by_status?.interview_scheduled || 0}</div>
                    </div>
                    <div className="stat-card">
                        <div className="stat-label">Offers</div>
                        <div className="stat-value">{stats.by_status?.offer_received || 0}</div>
                    </div>
                </div>
                
                <div className="grid-2">
                    <div className="card">
                        <div className="card-title">By Status</div>
                        {Object.entries(stats.by_status || {}).map(([s, n]) => (
                            <div key={s} className="flex-between" style={{marginBottom: 12}}>
                                <Status status={s} />
                                <span style={{fontWeight: 600}}>{n}</span>
                            </div>
                        ))}
                    </div>
                    <div className="card">
                        <div className="card-title">Recent</div>
                        {apps.slice(0, 5).map(a => (
                            <div key={a.id} className="flex-between" style={{marginBottom: 12, paddingBottom: 12, borderBottom: '1px solid #eee'}}>
                                <div>
                                    <div style={{fontWeight: 600}}>{a.position}</div>
                                    <div className="text-muted text-sm">{a.company}</div>
                                </div>
                                <Status status={a.status} />
                            </div>
                        ))}
                        {apps.length === 0 && <p className="text-muted">No applications yet</p>}
                    </div>
                </div>
            </div>
        );
        
        // Applications List
        const Applications = ({ apps, onEdit, onDelete, onStatus }) => {
            const [search, setSearch] = useState('');
            const [filter, setFilter] = useState('all');
            
            const filtered = apps.filter(a => {
                if (filter !== 'all' && a.status !== filter) return false;
                if (search && !a.company.toLowerCase().includes(search.toLowerCase()) && !a.position.toLowerCase().includes(search.toLowerCase())) return false;
                return true;
            });
            
            return (
                <div>
                    <h1 className="page-title">Applications</h1>
                    <p className="page-desc">{apps.length} total applications tracked</p>
                    
                    <div className="filter-bar">
                        <input type="text" className="form-input search-input" placeholder="Search..." value={search} onChange={e => setSearch(e.target.value)} />
                        <select className="form-input" value={filter} onChange={e => setFilter(e.target.value)}>
                            <option value="all">All status</option>
                            <option value="pending">Pending</option>
                            <option value="applied">Applied</option>
                            <option value="interview_scheduled">Interview</option>
                            <option value="offer_received">Offer</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    
                    <div className="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Company</th>
                                    <th>Position</th>
                                    <th>Status</th>
                                    <th>Platform</th>
                                    <th style={{width: 100}}></th>
                                </tr>
                            </thead>
                            <tbody>
                                {filtered.map(a => (
                                    <tr key={a.id}>
                                        <td>
                                            <div className="company-name">{a.company}</div>
                                            {a.location && <div className="company-loc">{a.location}</div>}
                                        </td>
                                        <td>{a.position}</td>
                                        <td>
                                            <select className="form-input" value={a.status} onChange={e => onStatus(a.id, e.target.value)} style={{padding: '6px 30px 6px 10px', border: '1.5px solid #ddd'}}>
                                                <option value="pending">Pending</option>
                                                <option value="applied">Applied</option>
                                                <option value="interview_scheduled">Interview</option>
                                                <option value="offer_received">Offer</option>
                                                <option value="rejected">Rejected</option>
                                            </select>
                                        </td>
                                        <td className="text-muted">{a.platform || '—'}</td>
                                        <td>
                                            <div className="flex gap-8">
                                                {a.job_url && <a href={a.job_url} target="_blank" className="btn-icon" title="Open">↗</a>}
                                                <button onClick={() => onEdit(a)} className="btn-icon" title="Edit">✎</button>
                                                <button onClick={() => onDelete(a.id)} className="btn-icon danger" title="Delete">×</button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                        {filtered.length === 0 && <div className="empty-state"><h3>No applications found</h3><p>Try adjusting your filters</p></div>}
                    </div>
                </div>
            );
        };
        
        // Application Modal
        const AppModal = ({ app, onSave, onClose }) => {
            const [form, setForm] = useState(app || { company: '', position: '', job_url: '', job_description: '', location: '', platform: '', notes: '', status: 'pending' });
            const set = (k, v) => setForm({ ...form, [k]: v });
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={e => e.stopPropagation()}>
                        <div className="modal-header">{app ? 'Edit Application' : 'New Application'}</div>
                        <form onSubmit={e => { e.preventDefault(); onSave(form); }} className="modal-body">
                            <div className="grid-2">
                                <div className="form-group">
                                    <label className="form-label">Company *</label>
                                    <input className="form-input" required value={form.company} onChange={e => set('company', e.target.value)} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Position *</label>
                                    <input className="form-input" required value={form.position} onChange={e => set('position', e.target.value)} />
                                </div>
                            </div>
                            <div className="form-group">
                                <label className="form-label">Job URL</label>
                                <input className="form-input" type="url" value={form.job_url} onChange={e => set('job_url', e.target.value)} />
                            </div>
                            <div className="grid-3">
                                <div className="form-group">
                                    <label className="form-label">Location</label>
                                    <input className="form-input" value={form.location} onChange={e => set('location', e.target.value)} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Platform</label>
                                    <select className="form-input" value={form.platform} onChange={e => set('platform', e.target.value)}>
                                        <option value="">—</option>
                                        <option>LinkedIn</option>
                                        <option>Indeed</option>
                                        <option>Glassdoor</option>
                                        <option>Company Site</option>
                                        <option>Referral</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Status</label>
                                    <select className="form-input" value={form.status} onChange={e => set('status', e.target.value)}>
                                        <option value="pending">Pending</option>
                                        <option value="applied">Applied</option>
                                        <option value="interview_scheduled">Interview</option>
                                        <option value="offer_received">Offer</option>
                                        <option value="rejected">Rejected</option>
                                    </select>
                                </div>
                            </div>
                            <div className="form-group">
                                <label className="form-label">Job Description</label>
                                <textarea className="form-input" value={form.job_description} onChange={e => set('job_description', e.target.value)} placeholder="Paste job description for AI analysis..." />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Notes</label>
                                <textarea className="form-input" style={{minHeight: 80}} value={form.notes} onChange={e => set('notes', e.target.value)} />
                            </div>
                        </form>
                        <div className="modal-footer">
                            <button type="button" className="btn" onClick={onClose}>Cancel</button>
                            <button type="submit" className="btn btn-primary" onClick={() => onSave(form)}>{app ? 'Save' : 'Add'}</button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // AI Customize
        const AICustomize = ({ settings }) => {
            const [form, setForm] = useState({ company: '', position: '', job_description: '', tone: 'professional' });
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            
            const generate = async () => {
                if (!form.company || !form.position || !form.job_description) return alert('Fill all fields');
                if (!settings.base_resume) return alert('Add your resume in Settings first');
                if (!settings.openai_api_key_set) return alert('Add OpenAI API key in Settings first');
                
                setLoading(true);
                const res = await api.post('/customize', form);
                setLoading(false);
                if (res.success) setResult(res.data);
                else alert(res.error);
            };
            
            return (
                <div>
                    <h1 className="page-title">AI Customize</h1>
                    <p className="page-desc">Generate tailored documents for each application</p>
                    
                    {(!settings.base_resume || !settings.openai_api_key_set) && (
                        <div className="alert alert-warning">
                            Configure in Settings first:
                            {!settings.base_resume && <span> • Add your resume</span>}
                            {!settings.openai_api_key_set && <span> • Add OpenAI API key</span>}
                        </div>
                    )}
                    
                    <div className="grid-2">
                        <div>
                            <div className="card">
                                <div className="card-title">Job Details</div>
                                <div className="form-group">
                                    <label className="form-label">Company</label>
                                    <input className="form-input" value={form.company} onChange={e => setForm({...form, company: e.target.value})} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Position</label>
                                    <input className="form-input" value={form.position} onChange={e => setForm({...form, position: e.target.value})} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Tone</label>
                                    <select className="form-input" value={form.tone} onChange={e => setForm({...form, tone: e.target.value})}>
                                        <option value="professional">Professional</option>
                                        <option value="enthusiastic">Enthusiastic</option>
                                        <option value="formal">Formal</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Job Description</label>
                                    <textarea className="form-input" style={{minHeight: 200}} value={form.job_description} onChange={e => setForm({...form, job_description: e.target.value})} placeholder="Paste the full job description..." />
                                </div>
                                <button onClick={generate} disabled={loading} className="btn btn-primary" style={{width: '100%'}}>
                                    {loading ? 'Generating...' : 'Generate Documents'}
                                </button>
                            </div>
                        </div>
                        <div>
                            {result ? (
                                <>
                                    {result.resume?.data?.match_score && (
                                        <div className="card">
                                            <div className="card-title">Match Analysis</div>
                                            <div className="flex gap-16" style={{alignItems: 'center'}}>
                                                <div className="match-score">{result.resume.data.match_score}%</div>
                                                <div>
                                                    {(result.resume.data.matched_keywords || []).slice(0, 6).map((k, i) => (
                                                        <span key={i} className="keyword-tag">{k}</span>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    {result.cover_letter?.data?.cover_letter && (
                                        <div className="card">
                                            <div className="flex-between">
                                                <div className="card-title">Cover Letter</div>
                                                <button className="btn btn-sm" onClick={() => navigator.clipboard.writeText(result.cover_letter.data.cover_letter)}>Copy</button>
                                            </div>
                                            <div className="ai-result">
                                                <pre>{result.cover_letter.data.cover_letter}</pre>
                                            </div>
                                        </div>
                                    )}
                                </>
                            ) : (
                                <div className="card">
                                    <div className="empty-state">
                                        <h3>Ready to generate</h3>
                                        <p>Fill in job details and click Generate</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        
        // Job Search
        const JobSearch = ({ onAdd }) => {
            const [form, setForm] = useState({ query: '', location: 'Montreal', platforms: ['linkedin', 'indeed'], num_jobs: 25 });
            const [loading, setLoading] = useState(false);
            const [results, setResults] = useState(null);
            
            const search = async () => {
                if (!form.query) return alert('Enter search query');
                setLoading(true);
                const res = await api.post('/scrape', form);
                setLoading(false);
                setResults(res);
            };
            
            const togglePlatform = (p) => {
                setForm({
                    ...form,
                    platforms: form.platforms.includes(p) ? form.platforms.filter(x => x !== p) : [...form.platforms, p]
                });
            };
            
            return (
                <div>
                    <h1 className="page-title">Job Search</h1>
                    <p className="page-desc">Search and scrape jobs from multiple platforms</p>
                    
                    <div className="card mb-24">
                        <div className="grid-3" style={{gridTemplateColumns: '2fr 1fr 1fr'}}>
                            <div className="form-group">
                                <label className="form-label">Search Query</label>
                                <input className="form-input" value={form.query} onChange={e => setForm({...form, query: e.target.value})} placeholder="Software Engineer..." />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Location</label>
                                <input className="form-input" value={form.location} onChange={e => setForm({...form, location: e.target.value})} />
                            </div>
                            <div className="form-group">
                                <label className="form-label">&nbsp;</label>
                                <button onClick={search} disabled={loading} className="btn btn-primary" style={{width: '100%'}}>
                                    {loading ? 'Searching...' : 'Search'}
                                </button>
                            </div>
                        </div>
                        <div className="flex gap-16 mt-16">
                            {['linkedin', 'indeed', 'glassdoor'].map(p => (
                                <label key={p} className="checkbox-label">
                                    <input type="checkbox" checked={form.platforms.includes(p)} onChange={() => togglePlatform(p)} />
                                    <span style={{textTransform: 'capitalize'}}>{p}</span>
                                </label>
                            ))}
                        </div>
                    </div>
                    
                    {results && (
                        <div className="table-wrap">
                            <div style={{padding: '16px 20px', borderBottom: '2px solid var(--border)', background: 'var(--bg)'}}>
                                <strong>{results.total_jobs} jobs found</strong>
                            </div>
                            <div style={{maxHeight: 500, overflowY: 'auto'}}>
                                {Object.entries(results.data || {}).flatMap(([p, jobs]) => jobs.map((job, i) => (
                                    <div key={`${p}-${i}`} className="job-item">
                                        <div>
                                            <div className="job-title">{job.title}</div>
                                            <div className="job-meta">{job.company} • {job.location || 'N/A'} • {job.platform}</div>
                                        </div>
                                        <button onClick={() => { onAdd({ company: job.company, position: job.title, job_url: job.url, location: job.location, platform: job.platform, status: 'pending' }); }} className="btn btn-sm">
                                            Add
                                        </button>
                                    </div>
                                )))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        // Settings
        const Settings = ({ settings, onSave }) => {
            const [form, setForm] = useState(settings);
            const [saving, setSaving] = useState(false);
            const [tests, setTests] = useState({});
            
            useEffect(() => setForm(settings), [settings]);
            
            const save = async () => {
                setSaving(true);
                await api.put('/settings', form);
                setSaving(false);
                onSave();
                alert('Saved');
            };
            
            const testEmail = async () => {
                setTests({...tests, email: 'Testing...'});
                const res = await api.post('/settings/test-email', {});
                setTests({...tests, email: res.success ? '✓ Connected' : '✗ ' + res.error, emailOk: res.success});
            };
            
            const testOpenAI = async () => {
                setTests({...tests, openai: 'Testing...'});
                const res = await api.post('/settings/test-openai', {});
                setTests({...tests, openai: res.success ? '✓ Connected' : '✗ ' + res.error, openaiOk: res.success});
            };
            
            return (
                <div>
                    <h1 className="page-title">Settings</h1>
                    <p className="page-desc">Configure your profile, resume, and integrations</p>
                    
                    <div className="settings-section">
                        <div className="settings-header">Profile</div>
                        <div className="settings-body">
                            <div className="grid-2">
                                <div className="form-group">
                                    <label className="form-label">Full Name</label>
                                    <input className="form-input" value={form.full_name || ''} onChange={e => setForm({...form, full_name: e.target.value})} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Email</label>
                                    <input className="form-input" type="email" value={form.email || ''} onChange={e => setForm({...form, email: e.target.value})} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Phone</label>
                                    <input className="form-input" value={form.phone || ''} onChange={e => setForm({...form, phone: e.target.value})} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Location</label>
                                    <input className="form-input" value={form.location || ''} onChange={e => setForm({...form, location: e.target.value})} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">LinkedIn</label>
                                    <input className="form-input" value={form.linkedin_url || ''} onChange={e => setForm({...form, linkedin_url: e.target.value})} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">GitHub</label>
                                    <input className="form-input" value={form.github_url || ''} onChange={e => setForm({...form, github_url: e.target.value})} />
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="settings-section">
                        <div className="settings-header">Resume / CV</div>
                        <div className="settings-body">
                            <p className="text-muted text-sm mb-24">Paste your resume text. This is used by AI to generate customized versions.</p>
                            <textarea className="form-input text-mono" style={{minHeight: 300}} value={form.base_resume || ''} onChange={e => setForm({...form, base_resume: e.target.value})} placeholder="JOHN DOE&#10;Software Engineer&#10;&#10;EXPERIENCE&#10;..." />
                            <p className="text-muted text-sm mt-16">{(form.base_resume || '').length} characters</p>
                        </div>
                    </div>
                    
                    <div className="settings-section">
                        <div className="settings-header">OpenAI</div>
                        <div className="settings-body">
                            <div className="form-group">
                                <label className="form-label">API Key {form.openai_api_key_set && <span style={{color: 'var(--success)'}}>(configured)</span>}</label>
                                <div className="flex gap-8">
                                    <input className="form-input" type="password" value={form.openai_api_key || ''} onChange={e => setForm({...form, openai_api_key: e.target.value})} placeholder="sk-..." style={{flex: 1}} />
                                    <button className="btn" onClick={testOpenAI}>Test</button>
                                </div>
                                {tests.openai && <div className={`test-result ${tests.openaiOk ? 'success' : 'error'}`}>{tests.openai}</div>}
                                <p className="text-muted text-sm mt-16">Get your key from <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a></p>
                            </div>
                        </div>
                    </div>
                    
                    <div className="settings-section">
                        <div className="settings-header">Email Notifications</div>
                        <div className="settings-body">
                            <div className="grid-2">
                                <div className="form-group">
                                    <label className="form-label">SMTP Server</label>
                                    <input className="form-input" value={form.smtp_server || 'smtp.gmail.com'} onChange={e => setForm({...form, smtp_server: e.target.value})} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Port</label>
                                    <input className="form-input" type="number" value={form.smtp_port || 587} onChange={e => setForm({...form, smtp_port: parseInt(e.target.value)})} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Email Address</label>
                                    <input className="form-input" type="email" value={form.smtp_email || ''} onChange={e => setForm({...form, smtp_email: e.target.value})} />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">App Password {form.smtp_password_set && <span style={{color: 'var(--success)'}}>(configured)</span>}</label>
                                    <input className="form-input" type="password" value={form.smtp_password || ''} onChange={e => setForm({...form, smtp_password: e.target.value})} />
                                </div>
                            </div>
                            <div className="flex gap-16 mt-16">
                                <button className="btn" onClick={testEmail}>Test Connection</button>
                                {tests.email && <span className={`test-result ${tests.emailOk ? 'success' : 'error'}`}>{tests.email}</span>}
                            </div>
                            <div className="mt-24">
                                <label className="checkbox-label">
                                    <input type="checkbox" checked={form.email_notifications || false} onChange={e => setForm({...form, email_notifications: e.target.checked})} />
                                    Enable email notifications
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div style={{textAlign: 'right'}}>
                        <button onClick={save} disabled={saving} className="btn btn-primary" style={{padding: '16px 48px'}}>
                            {saving ? 'Saving...' : 'Save Settings'}
                        </button>
                    </div>
                </div>
            );
        };
        
        // App
        const App = () => {
            const [page, setPage] = useState('dashboard');
            const [apps, setApps] = useState([]);
            const [stats, setStats] = useState({});
            const [settings, setSettings] = useState({});
            const [modal, setModal] = useState(null);
            const [loading, setLoading] = useState(true);
            
            const load = async () => {
                const [a, s, c] = await Promise.all([api.get('/applications'), api.get('/stats'), api.get('/settings')]);
                setApps(a.data || []);
                setStats(s.data || {});
                setSettings(c.data || {});
                setLoading(false);
            };
            
            useEffect(() => { load(); }, []);
            
            const saveApp = async (data) => {
                if (modal?.id) await api.put(`/applications/${modal.id}`, data);
                else await api.post('/applications', data);
                load();
                setModal(null);
            };
            
            const delApp = async (id) => {
                if (confirm('Delete?')) { await api.del(`/applications/${id}`); load(); }
            };
            
            const statusApp = async (id, status) => {
                await api.put(`/applications/${id}`, { status });
                load();
            };
            
            const addJob = async (data) => {
                await api.post('/applications', data);
                load();
                alert('Added');
            };
            
            return (
                <>
                    <aside className="sidebar">
                        <div className="logo">JOB TRACKER</div>
                        <nav className="nav">
                            {[['dashboard', 'Dashboard'], ['apps', 'Applications'], ['ai', 'AI Customize'], ['search', 'Job Search'], ['settings', 'Settings']].map(([id, label]) => (
                                <button key={id} onClick={() => setPage(id)} className={`nav-item ${page === id ? 'active' : ''}`}>
                                    {label}
                                </button>
                            ))}
                        </nav>
                        <div className="sidebar-footer">
                            <button className="btn-new" onClick={() => setModal({})}>+ New Application</button>
                        </div>
                    </aside>
                    
                    <main className="main">
                        {loading ? (
                            <div className="loading">Loading...</div>
                        ) : (
                            <>
                                {page === 'dashboard' && <Dashboard stats={stats} apps={apps} />}
                                {page === 'apps' && <Applications apps={apps} onEdit={setModal} onDelete={delApp} onStatus={statusApp} />}
                                {page === 'ai' && <AICustomize settings={settings} />}
                                {page === 'search' && <JobSearch onAdd={addJob} />}
                                {page === 'settings' && <Settings settings={settings} onSave={load} />}
                            </>
                        )}
                    </main>
                    
                    {modal && <AppModal app={modal.id ? modal : null} onSave={saveApp} onClose={() => setModal(null)} />}
                </>
            );
        };
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>